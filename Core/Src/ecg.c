#include "arm_math.h"
#include "buffer_and_usb.h"
#include "ecg.h"

circularBuffer_t ecgBuffer = {{0}, 0, 0, ecg_size};
uint8_t ecg_uint8_t[ecg_size];

static q15_t ecg[ecg_size] = {
6235, 6238, 6241, 6244, 6247, 6249, 6252, 6255, 6258, 6261,
6264, 6267, 6270, 6273, 6276, 6279, 6282, 6285, 6288, 6291,
6294, 6297, 6300, 6303, 6306, 6309, 6312, 6315, 6318, 6321,
6324, 6327, 6330, 6333, 6336, 6338, 6341, 6344, 6347, 6350,
6353, 6355, 6358, 6361, 6364, 6367, 6369, 6372, 6375, 6378,
6381, 6384, 6387, 6390, 6393, 6396, 6399, 6402, 6405, 6409,
6412, 6415, 6419, 6422, 6426, 6430, 6434, 6438, 6442, 6446,
6450, 6455, 6460, 6464, 6469, 6474, 6480, 6485, 6491, 6497,
6503, 6509, 6516, 6523, 6529, 6536, 6543, 6549, 6557, 6564,
6572, 6580, 6588, 6597, 6607, 6617, 6628, 6639, 6652, 6665,
6678, 6693, 6709, 6726, 6743, 6762, 6782, 6803, 6825, 6848,
6873, 6898, 6925, 6954, 6983, 7014, 7047, 7081, 7116, 7153,
7191, 7231, 7272, 7315, 7359, 7405, 7453, 7502, 7552, 7605,
7659, 7714, 7771, 7830, 7891, 7953, 8017, 8082, 8149, 8218,
8288, 8360, 8433, 8508, 8585, 8663, 8743, 8825, 8908, 8992,
9078, 9166, 9255, 9345, 9437, 9530, 9625, 9721, 9819, 9918,
10018, 10120, 10223, 10326, 10430, 10534, 10638, 10742, 10845, 10949,
11051, 11153, 11253, 11353, 11451, 11547, 11642, 11735, 11826, 11916,
12002, 12087, 12169, 12249, 12325, 12399, 12471, 12539, 12604, 12666,
12724, 12779, 12831, 12879, 12924, 12965, 13003, 13036, 13066, 13092,
13115, 13133, 13147, 13158, 13164, 13167, 13165, 13159, 13150, 13136,
13119, 13097, 13072, 13042, 13009, 12972, 12931, 12886, 12837, 12785,
12729, 12669, 12606, 12539, 12469, 12396, 12319, 12240, 12157, 12073,
11985, 11896, 11804, 11711, 11615, 11519, 11421, 11322, 11221, 11120,
11018, 10916, 10813, 10710, 10607, 10503, 10400, 10297, 10194, 10091,
9990, 9888, 9788, 9688, 9589, 9492, 9395, 9300, 9205, 9113,
9021, 8931, 8843, 8756, 8671, 8587, 8505, 8425, 8347, 8270,
8196, 8123, 8052, 7983, 7916, 7851, 7788, 7727, 7668, 7611,
7555, 7502, 7450, 7401, 7353, 7307, 7262, 7220, 7178, 7138,
7100, 7063, 7028, 6994, 6962, 6932, 6903, 6875, 6849, 6824,
6801, 6779, 6757, 6737, 6717, 6698, 6680, 6661, 6643, 6625,
6606, 6586, 6566, 6545, 6522, 6497, 6471, 6442, 6410, 6376,
6338, 6297, 6251, 6201, 6147, 6087, 6023, 5951, 5873, 5787,
5694, 5593, 5484, 5367, 5243, 5112, 4974, 4830, 4681, 4527,
4371, 4212, 4052, 3893, 3736, 3583, 3435, 3295, 3165, 3046,
2941, 2850, 2776, 2724, 2695, 2693, 2721, 2781, 2877, 3009,
3180, 3392, 3647, 3946, 4290, 4681, 5120, 5607, 6143, 6728,
7363, 8048, 8782, 9566, 10398, 11279, 12206, 13182, 14203, 15263,
16354, 17467, 18595, 19730, 20865, 21990, 23100, 24186, 25240, 26256,
27225, 28140, 28995, 29781, 30491, 31119, 31656, 32097, 32434, 32659,
32767, 32751, 32613, 32358, 31992, 31521, 30950, 30286, 29535, 28703,
27798, 26826, 25794, 24710, 23582, 22417, 21224, 20010, 18785, 17556,
16333, 15124, 13940, 12789, 11675, 10600, 9567, 8580, 7642, 6753,
5917, 5135, 4409, 3739, 3126, 2570, 2072, 1630, 1245, 915,
640, 416, 243, 118, 38, 0, 2, 43, 121, 230,
368, 531, 715, 917, 1134, 1364, 1603, 1848, 2099, 2351,
2604, 2855, 3102, 3344, 3579, 3807, 4026, 4235, 4433, 4620,
4795, 4958, 5109, 5247, 5374, 5490, 5595, 5691, 5778, 5857,
5928, 5992, 6050, 6102, 6149, 6191, 6228, 6262, 6293, 6320,
6345, 6368, 6389, 6408, 6426, 6443, 6458, 6474, 6489, 6503,
6518, 6532, 6546, 6561, 6575, 6589, 6604, 6619, 6634, 6650,
6666, 6683, 6699, 6717, 6734, 6753, 6771, 6791, 6810, 6831,
6852, 6873, 6895, 6918, 6942, 6966, 6990, 7016, 7042, 7069,
7097, 7125, 7154, 7184, 7215, 7247, 7279, 7312, 7347, 7382,
7418, 7455, 7492, 7531, 7571, 7611, 7653, 7695, 7739, 7783,
7829, 7875, 7923, 7971, 8021, 8071, 8123, 8176, 8229, 8284,
8340, 8397, 8455, 8514, 8575, 8636, 8698, 8762, 8826, 8892,
8959, 9027, 9096, 9166, 9238, 9310, 9384, 9459, 9536, 9614,
9694, 9775, 9858, 9942, 10027, 10113, 10201, 10290, 10379, 10470,
10562, 10654, 10748, 10842, 10937, 11032, 11128, 11225, 11322, 11419,
11517, 11616, 11714, 11813, 11912, 12012, 12111, 12210, 12309, 12409,
12508, 12607, 12706, 12804, 12902, 13000, 13098, 13195, 13291, 13387,
13483, 13578, 13672, 13765, 13858, 13950, 14041, 14131, 14221, 14309,
14396, 14482, 14568, 14652, 14735, 14816, 14897, 14976, 15053, 15130,
15205, 15278, 15350, 15421, 15490, 15557, 15623, 15687, 15750, 15810,
15869, 15926, 15982, 16035, 16086, 16136, 16183, 16229, 16273, 16314,
16353, 16391, 16426, 16458, 16489, 16517, 16544, 16567, 16589, 16608,
16625, 16639, 16651, 16660, 16667, 16671, 16673, 16672, 16669, 16662,
16654, 16642, 16628, 16611, 16592, 16569, 16544, 16516, 16485, 16452,
16415, 16376, 16334, 16289, 16242, 16192, 16139, 16084, 16027, 15968,
15906, 15842, 15776, 15708, 15638, 15567, 15493, 15418, 15340, 15262,
15181, 15099, 15016, 14931, 14845, 14757, 14668, 14578, 14487, 14395,
14301, 14207, 14112, 14016, 13919, 13821, 13723, 13623, 13524, 13423,
13322, 13221, 13119, 13017, 12915, 12812, 12709, 12605, 12502, 12399,
12295, 12191, 12088, 11984, 11881, 11778, 11674, 11572, 11469, 11367,
11265, 11163, 11062, 10962, 10861, 10762, 10663, 10564, 10466, 10369,
10273, 10177, 10082, 9988, 9895, 9803, 9711, 9621, 9531, 9443,
9355, 9268, 9183, 9099, 9016, 8934, 8853, 8773, 8695, 8618,
8542, 8467, 8394, 8322, 8252, 8183, 8115, 8049, 7984, 7920,
7857, 7796, 7736, 7677, 7620, 7563, 7508, 7454, 7402, 7350,
7300, 7251, 7203, 7156, 7110, 7065, 7021, 6979, 6937, 6897,
6857, 6819, 6782, 6745, 6710, 6675, 6642, 6609, 6578, 6547,
6517, 6488, 6460, 6433, 6407, 6381, 6356, 6333, 6310, 6287,
6266, 6245, 6225, 6206, 6187, 6169, 6152, 6136, 6120, 6105,
6090, 6076, 6063, 6050, 6038, 6026, 6015, 6005, 5995, 5985,
5976, 5968, 5960, 5952, 5945, 5938, 5932, 5926, 5920, 5915,
5910, 5905, 5901, 5897, 5894, 5890, 5887, 5884, 5882, 5879,
5877, 5875, 5873, 5872, 5870, 5869, 5868, 5867, 5866, 5866,
5865, 5865, 5865, 5865, 5865, 5865, 5866, 5866, 5867, 5868,
5869, 5870, 5871, 5872, 5874, 5875, 5877, 5878, 5880, 5882,
5884, 5886, 5888, 5890, 5893, 5895, 5897, 5900, 5902, 5905,
5908, 5910, 5913, 5916, 5919, 5921, 5924, 5927, 5930, 5933,
5936, 5939, 5942, 5945, 5949, 5952, 5955, 5958, 5961, 5964,
5968, 5971, 5974, 5977, 5981, 5984, 5987, 5990, 5993, 5997,
6000, 6003, 6006, 6010, 6013, 6016, 6019, 6022, 6025, 6029,
6032, 6035, 6038, 6041, 6044, 6048, 6051, 6054, 6057, 6060,
6063, 6066, 6070, 6073, 6076, 6079, 6082, 6085, 6088, 6091,
6095, 6098, 6101, 6104, 6107, 6110, 6113, 6116, 6119, 6122,
6125, 6129, 6132, 6135, 6138, 6141, 6144, 6147, 6150, 6153,
6156, 6159, 6162, 6165, 6168, 6171, 6174, 6177, 6180, 6182};




void initECG(){

    for (int i = 0; i < ecg_size; i++) {
    	bufferWrite(&ecgBuffer, &ecg[i]);
    	ecg_uint8_t[i] = (uint8_t)((ecg[i]) >> 7);
        if(ecg_uint8_t[i] == 255){ecg_uint8_t[i] = 254;}
    }
};
